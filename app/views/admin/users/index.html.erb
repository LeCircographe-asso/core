<% content_for :title, "Users" %>
<div class="admin-dashboard">
  <div class="dashboard-title">
    <h1>Liste des Utilisateurs</h1>
  </div>

  <div id="dashboard-container">
    <div id="middle-column">
      <div class="search-filters" data-controller="user-search">
        <div class="search-bar">
          <%= form_with url: admin_users_path, method: :get, data: { turbo_frame: "users-list", turbo_action: "advance" } do |f| %>
            <%= f.text_field :query, 
                placeholder: "Rechercher un utilisateur...",
                class: "search-input",
                data: { 
                  action: "input->user-search#search",
                  user_search_target: "input" 
                } 
            %>
          <% end %>
        </div>

        <div class="sort-filters">
          <%= link_to "Nom ↑↓", 
              admin_users_path(sort: "name", direction: sort_direction),
              class: "sort-button #{"active" if params[:sort] == "name"}",
              data: { turbo_frame: "users-list" } %>
              
          <%= link_to "Date d'inscription ↑↓", 
              admin_users_path(sort: "created_at", direction: sort_direction),
              class: "sort-button #{"active" if params[:sort] == "created_at"}",
              data: { turbo_frame: "users-list" } %>
              
          <%= link_to "Rôle ↑↓", 
              admin_users_path(sort: "role", direction: sort_direction),
              class: "sort-button #{"active" if params[:sort] == "role"}",
              data: { turbo_frame: "users-list" } %>
        </div>
      </div>

      <%= turbo_frame_tag "users-list" do %>
        <div class="users-grid">
          <% @users.each do |user| %>
            <div class="user-card">
              <div class="user-info">
                <h3><%= user.full_name %></h3>
                <p class="user-email"><%= user.email %></p>
                <p class="user-role"><%= user.role %></p>
                <p class="user-date">Inscrit le <%= l(user.created_at, format: :long) %></p>
              </div>
              <div class="user-actions">
                <%= link_to "Voir", admin_user_path(user), class: "white-button" %>
                <%= link_to "Modifier", edit_admin_user_path(user), class: "purple-button" %>
              </div>
            </div>
          <% end %>
        </div>

        <div class="pagination">
          <%== pagy_nav(@pagy) %>
        </div>
      <% end %>
    </div>
  </div>
</div>